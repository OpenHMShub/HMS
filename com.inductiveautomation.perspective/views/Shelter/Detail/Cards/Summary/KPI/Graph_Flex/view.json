{
  "custom": {
    "key": "value"
  },
  "params": {
    "Title": "\"Title\"",
    "facilityId": 5
  },
  "propConfig": {
    "custom.key": {
      "persistent": true
    },
    "params.Title": {
      "paramDirection": "input",
      "persistent": true
    },
    "params.facilityId": {
      "onChange": {
        "enabled": null,
        "script": "\troot \u003d self.getChild(\"root\")\n\troot.setChart()"
      },
      "paramDirection": "input",
      "persistent": true
    }
  },
  "props": {
    "defaultSize": {
      "height": 140,
      "width": 300
    }
  },
  "root": {
    "children": [
      {
        "meta": {
          "name": "Title"
        },
        "position": {
          "basis": "20%",
          "grow": 1,
          "shrink": 0
        },
        "propConfig": {
          "props.text": {
            "binding": {
              "config": {
                "path": "view.params.Title"
              },
              "type": "property"
            }
          }
        },
        "props": {
          "alignVertical": "bottom",
          "style": {
            "classes": "KPIs/KPI_Title",
            "textAlign": "start"
          }
        },
        "type": "ia.display.label"
      },
      {
        "meta": {
          "name": "TimeSeriesChart"
        },
        "position": {
          "basis": "80%",
          "grow": 1
        },
        "props": {
          "defaultStyles": {
            "colorScheme": "Paired"
          },
          "plots": [
            {
              "axes": [
                {
                  "alignment": "left",
                  "label": {
                    "font": {
                      "color": "",
                      "size": 10
                    },
                    "offset": 0,
                    "style": {
                      "classes": ""
                    },
                    "text": "",
                    "visible": true
                  },
                  "max": 10,
                  "min": 0,
                  "name": "Enrollment",
                  "style": {
                    "classes": ""
                  },
                  "tick": {
                    "color": "",
                    "label": {
                      "font": {
                        "color": "",
                        "size": 10
                      },
                      "style": {
                        "classes": ""
                      }
                    },
                    "style": {
                      "classes": ""
                    }
                  },
                  "width": 0
                }
              ],
              "markers": [],
              "trends": [
                {
                  "axis": "Enrollment",
                  "baselines": [],
                  "breakLine": true,
                  "columns": [],
                  "interpolation": "curveStep",
                  "radius": 2,
                  "series": "Enrollment",
                  "stack": true,
                  "type": "area",
                  "visible": true
                },
                {
                  "axis": "Enrollment",
                  "baselines": [],
                  "breakLine": true,
                  "columns": [
                    {
                      "color": "#4747FF",
                      "key": "Enrollment",
                      "styles": {
                        "highlighted": {
                          "fill": {
                            "color": "",
                            "opacity": null
                          },
                          "stroke": {
                            "color": "",
                            "dashArray": null,
                            "opacity": null,
                            "width": null
                          }
                        },
                        "muted": {
                          "fill": {
                            "color": "",
                            "opacity": null
                          },
                          "stroke": {
                            "color": "",
                            "dashArray": null,
                            "opacity": null,
                            "width": null
                          }
                        },
                        "normal": {
                          "fill": {
                            "color": "",
                            "opacity": null
                          },
                          "stroke": {
                            "color": "",
                            "dashArray": null,
                            "opacity": null,
                            "width": null
                          }
                        },
                        "selected": {
                          "fill": {
                            "color": "",
                            "opacity": null
                          },
                          "stroke": {
                            "color": "",
                            "dashArray": null,
                            "opacity": null,
                            "width": null
                          }
                        }
                      }
                    }
                  ],
                  "interpolation": "curveStep",
                  "radius": 2,
                  "series": "Enrollment",
                  "stack": true,
                  "type": "line",
                  "visible": true
                }
              ]
            }
          ],
          "series": [
            {
              "data": [
                {
                  "Enrollment": 1,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1608763662669
                  }
                },
                {
                  "Enrollment": 1,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1608850062669
                  }
                },
                {
                  "Enrollment": 1,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1608936462669
                  }
                },
                {
                  "Enrollment": 1,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1609022862669
                  }
                },
                {
                  "Enrollment": 1,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1609109262669
                  }
                },
                {
                  "Enrollment": 1,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1609195662669
                  }
                },
                {
                  "Enrollment": 1,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1609282062669
                  }
                },
                {
                  "Enrollment": 1,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1609368462669
                  }
                },
                {
                  "Enrollment": 1,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1609454862669
                  }
                },
                {
                  "Enrollment": 1,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1609541262669
                  }
                },
                {
                  "Enrollment": 1,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1609627662669
                  }
                },
                {
                  "Enrollment": 1,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1609714062669
                  }
                },
                {
                  "Enrollment": 1,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1609800462669
                  }
                },
                {
                  "Enrollment": 1,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1609886862669
                  }
                },
                {
                  "Enrollment": 1,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1609973262669
                  }
                },
                {
                  "Enrollment": 1,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1610059662669
                  }
                },
                {
                  "Enrollment": 1,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1610146062669
                  }
                },
                {
                  "Enrollment": 1,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1610232462669
                  }
                },
                {
                  "Enrollment": 1,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1610318862669
                  }
                },
                {
                  "Enrollment": 1,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1610405262669
                  }
                },
                {
                  "Enrollment": 1,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1610491662669
                  }
                },
                {
                  "Enrollment": 1,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1610578062669
                  }
                },
                {
                  "Enrollment": 1,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1610664462669
                  }
                },
                {
                  "Enrollment": 1,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1610750862669
                  }
                },
                {
                  "Enrollment": 1,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1610837262669
                  }
                },
                {
                  "Enrollment": 2,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1610923662669
                  }
                },
                {
                  "Enrollment": 2,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1611010062669
                  }
                },
                {
                  "Enrollment": 2,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1611096462669
                  }
                },
                {
                  "Enrollment": 2,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1611182862669
                  }
                },
                {
                  "Enrollment": 2,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1611269262669
                  }
                },
                {
                  "Enrollment": 2,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1611355662669
                  }
                },
                {
                  "Enrollment": 2,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1611442062669
                  }
                },
                {
                  "Enrollment": 2,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1611528462669
                  }
                },
                {
                  "Enrollment": 2,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1611614862669
                  }
                },
                {
                  "Enrollment": 2,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1611701262669
                  }
                },
                {
                  "Enrollment": 2,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1611787662669
                  }
                },
                {
                  "Enrollment": 2,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1611874062669
                  }
                },
                {
                  "Enrollment": 2,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1611960462669
                  }
                },
                {
                  "Enrollment": 2,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1612046862669
                  }
                },
                {
                  "Enrollment": 2,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1612133262669
                  }
                },
                {
                  "Enrollment": 2,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1612219662669
                  }
                },
                {
                  "Enrollment": 2,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1612306062669
                  }
                },
                {
                  "Enrollment": 2,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1612392462669
                  }
                },
                {
                  "Enrollment": 2,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1612478862669
                  }
                },
                {
                  "Enrollment": 2,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1612565262669
                  }
                },
                {
                  "Enrollment": 2,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1612651662669
                  }
                },
                {
                  "Enrollment": 3,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1612738062669
                  }
                },
                {
                  "Enrollment": 3,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1612824462669
                  }
                },
                {
                  "Enrollment": 3,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1612910862669
                  }
                },
                {
                  "Enrollment": 3,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1612997262669
                  }
                },
                {
                  "Enrollment": 3,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1613083662669
                  }
                },
                {
                  "Enrollment": 3,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1613170062669
                  }
                },
                {
                  "Enrollment": 3,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1613256462669
                  }
                },
                {
                  "Enrollment": 3,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1613342862669
                  }
                },
                {
                  "Enrollment": 3,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1613429262669
                  }
                },
                {
                  "Enrollment": 3,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1613515662669
                  }
                },
                {
                  "Enrollment": 3,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1613602062669
                  }
                },
                {
                  "Enrollment": 3,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1613688462669
                  }
                },
                {
                  "Enrollment": 3,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1613774862669
                  }
                },
                {
                  "Enrollment": 3,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1613861262669
                  }
                },
                {
                  "Enrollment": 0,
                  "time": {
                    "$": [
                      "ts",
                      192,
                      1613947662675
                    ],
                    "$ts": 1613947662669
                  }
                }
              ],
              "name": "Enrollment"
            }
          ],
          "timeAxis": {
            "height": 20,
            "tick": {
              "label": {
                "format": "MMM, DD"
              }
            }
          },
          "timeRange": {
            "timeFormat": "HH:mm:ss",
            "visible": false
          },
          "title": {
            "height": 0
          },
          "xTrace": {
            "infoBox": {
              "dateFormat": "MMM D, YYYY",
              "timeFormat": ""
            }
          }
        },
        "type": "ia.chart.timeseries"
      }
    ],
    "meta": {
      "name": "root"
    },
    "props": {
      "direction": "column",
      "style": {
        "backgroundColor": "#FFFFFF",
        "paddingLeft": 5
      }
    },
    "scripts": {
      "customMethods": [
        {
          "name": "getDaysBetween",
          "params": [
            "t1",
            "t2"
          ],
          "script": "\tdateList \u003d []\n\t\n\tif system.date.isBefore(t1, t2):\n\t\tk \u003d 1\n\telse:\n\t\tt1, t2 \u003d t2, t1\n\t\tk \u003d -1\n\t\n\tt \u003d t1\n\t\n\t# use t2_day_after to include also t2\n\tt2_day_after \u003d system.date.addDays(t2, 1)\n\twhile system.date.isBefore(t, t2_day_after):\n\t\tdateList.append(t)\n\t\tt \u003d system.date.addDays(t,1)\n\t\tif t \u003d\u003d t2_day_after:\n\t\t\tbreak\n\n\treturn dateList[::k]"
        },
        {
          "name": "setChart",
          "params": [],
          "script": "\t\n\tchart \u003d self.getChild(\"TimeSeriesChart\")\n\tdelta \u003d 60\n\td2 \u003d system.date.now()\n\td1 \u003d system.date.addDays(d2,-(delta))\n\tdays \u003d self.getDaysBetween(d1,d2) \n\tfacilityId \u003d self.view.params.facilityId\n\n\tquery \u003d \"\"\"\nDECLARE @StartInterval date \u003d CAST(? AS date)   \nDECLARE @EndInterval date \u003d CAST(? AS date)\n\nSELECT [BedLog].[id] ,[BedLog].[bedId] ,    \nCASE WHEN eventStart \u003c @StartInterval THEN @StartInterval \n\t\tELSE CAST(eventStart AS date) END AS eventStart ,   \nCASE WHEN ISNULL([BedLog].[eventEnd],@EndInterval) \u003e @EndInterval THEN @EndInterval \n\t\tELSE CAST(ISNULL([BedLog].[eventEnd],@EndInterval) AS date) END AS eventEnd   \nFROM [lodging].[BedLog]  \nINNER JOIN [lodging].[Bed] ON [BedLog].[bedId] \u003d [Bed].[id]\nINNER JOIN [lodging].[Room] ON [Bed].[roomId] \u003d [Room].[id] \nWHERE ([Room].[facilityId]  \u003d ?\nAND [BedLog].[eventStart] IS NOT NULL    \nAND CAST([BedLog].[eventStart] AS date) \u003c\u003d @EndInterval\nAND CAST(ISNULL([BedLog].[eventEnd],@EndInterval) AS date) \u003e\u003d @StartInterval)\t\t\n\t\t\"\"\"\n\t\n\tresult \u003d system.db.runPrepQuery(query,[d1,d2,facilityId],\u0027HMSOps\u0027)\n\t\n\tseries \u003d []\n\tdata \u003d []\n\tfor day in days:\n\t\tdata.append({\"Enrollment\": 0, \"time\": day}) \n\t\t\t\t      \n\t\tfor item in system.dataset.toPyDataSet(result):\n\t\t\n\t\t\tif system.date.isBetween(day, item[\u0027eventStart\u0027], item[\u0027eventEnd\u0027]):\n\t\t\t\tdata[-1][\u0027Enrollment\u0027] +\u003d 1\n\t\t\t\n\t\n\tseries.append({\"name\": \"Enrollment\", \"data\": data})\n\t\n\t#ystem.perspective.print((\"series\", series))\n\tmaxValueInData \u003d max([x[\u0027Enrollment\u0027] for x in data])\n\t\n\tchart.props.series \u003d series\n\tchart.props.plots[0][\u0027axes\u0027][0][\u0027max\u0027]  \u003d (maxValueInData / 5 + 1) * 5\n\t\n\t\n\tjsonPlots \u003d \u0027\u0027\u0027[\n\t  {\n\t    \"trends\": [\n\t      {\n\t        \"visible\": true,\n\t        \"type\": \"area\",\n\t        \"series\": \"Enrollment\",\n\t        \"interpolation\": \"curveLinear\",\n\t        \"breakLine\": true,\n\t        \"stack\": true,\n\t        \"radius\": 2,\n\t        \"axis\": \"Enrollment\",\n\t        \"columns\": [],\n\t        \"baselines\": []\n\t      }\n\t    ],\n\t    \"axes\": [\n\t      {\n\t        \"name\": \"Enrollment\",\n\t        \"min\": 0,\n\t        \"max\": \"\",\n\t        \"alignment\": \"left\",\n\t        \"width\": 12,\n\t        \"label\": {\n\t          \"visible\": true,\n\t          \"text\": \"\",\n\t          \"offset\": 0,\n\t          \"font\": {\n\t            \"color\": \"\",\n\t            \"size\": 10\n\t          },\n\t          \"style\": {\n\t            \"classes\": \"\"\n\t          }\n\t        },\n\t        \"tick\": {\n\t          \"color\": \"\",\n\t          \"label\": {\n\t            \"font\": {\n\t              \"color\": \"\",\n\t              \"size\": 10\n\t            },\n\t            \"style\": {\n\t              \"classes\": \"\"\n\t            }\n\t          },\n\t          \"style\": {\n\t            \"classes\": \"\"\n\t          }\n\t        },\n\t        \"style\": {\n\t          \"classes\": \"\"\n\t        }\n\t      }\n\t    ],\n\t    \"markers\": []\n\t  }\n\t]\u0027\u0027\u0027"
        }
      ],
      "extensionFunctions": null,
      "messageHandlers": []
    },
    "type": "ia.container.flex"
  }
}